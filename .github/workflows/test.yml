name: Test Action

on:
  push:
    branches:
    - main
  pull_request:
    types:
      - converted_to_draft
      - ready_for_review
      - synchronize
      - opened
      - reopened
permissions:
  contents: read

defaults:
  run:
    shell: bash

jobs:
  test-all:
    name: Test Action on ${{ matrix.os }}
    runs-on: ubuntu-latest
    steps:
      - name: Harden Runner
        id: harden-runner
        uses: step-security/harden-runner@ec9f2d5744a09debf3a187a3f4f675c53b671911 # v2.13.0
        with:
          egress-policy: audit

      - name: Checkout Repository
        uses: actions/checkout@93cb6efe18208431cddfb8368fd83d5badbf9bfd # v5.0.1

      - name: Run Action
        uses: ./
        id: test-all
        with:
          checkout: true
          checkout-fetch-depth: 0
          checkout-ref: 2-update-composite-action-for-real-life
          checkout-token: ${{ secrets.GITHUB_TOKEN }}
          setup-java: true
          java-distribution: 'temurin'
          java-version: '17'
          setup-gradle: true
          gradle-version: '7.5'
          setup-node: true
          node-version: '18'
          setup-python: true
          python-version: '3.9'
          setup-go: true
          go-version: '1.20'
          setup-rust: true
          rust-version: '1.70.0'
          setup-swift: true
          swift-version: '5.7'

      - name: Verify Setup
        run: |
          echo "::group::Verify Checkout Outputs"
            echo "Checkout Ref: ${{ steps.test-all.outputs.checkout-ref }}"
            echo "Checkout Commit: ${{ steps.test-all.outputs.checkout-commit }}"
          echo "::endgroup::"
          echo "::group::Verify Java Outputs"
            echo "Java Distribution: ${{ steps.test-all.outputs.java-distribution }}"
            echo "Java Version: ${{ steps.test-all.outputs.java-version }}"
            echo "Java Path: ${{ steps.test-all.outputs.java-path }}"
            echo "Java Cache Hit: ${{ steps.test-all.outputs.java-cache-hit }}"
            java -version
          echo "::endgroup::"
          echo "::group::Verify Gradle Outputs"
            echo "Gradle Version: ${{ steps.test-all.outputs.gradle-version }}"
            echo "Gradle Build Scan URL: ${{ steps.test-all.outputs.gradle-build-scan-url }}"
            echo "Gradle Dependency Graph File: ${{ steps.test-all.outputs.gradle-dependency-graph-file }}"
            gradle -v
          echo "::endgroup::"
          echo "::group::Verify Node.js Outputs"
            echo "Node.js Version: ${{ steps.test-all.outputs.node-version }}"
            echo "Node.js Cache Hit: ${{ steps.test-all.outputs.node-cache-hit }}"
            node -v
            npm -v
          echo "::endgroup::"
          echo "::group::Verify Python Outputs"
            echo "Python Version: ${{ steps.test-all.outputs.python-version }}"
            echo "Python Path: ${{ steps.test-all.outputs.python-path }}"
            echo "Python Cache Hit: ${{ steps.test-all.outputs.python-cache-hit }}"
            python --version
            pip --version
          echo "::endgroup::"
          echo "::group::Verify Go Outputs"
            echo "Go Version: ${{ steps.test-all.outputs.go-version }}"
            echo "Go Cache Hit: ${{ steps.test-all.outputs.go-cache-hit }}"
            go version
          echo "::endgroup::"
          echo "::group::Verify Rust Outputs"
            echo "Rust Name: ${{ steps.test-all.outputs.rust-name }}"
            echo "Rust Cache Key: ${{ steps.test-all.outputs.rust-cachekey }}"
            rustc --version
            cargo --version
          echo "::endgroup::"
          echo "::group::Verify Swift Outputs"
            echo "Swift Version: ${{ steps.test-all.outputs.swift-version }}"
            echo "Swift Toolchain: ${{ steps.test-all.outputs.swift-toolchain }}"
            echo "Swift SDKs: ${{ steps.test-all.outputs.swift-sdks }}"
            swift --version
          echo "::endgroup::"

  test-checkout:
    name: Test Checkout Action
    runs-on: ubuntu-latest
    steps:
      - name: Harden Runner
        id: harden-runner
        uses: step-security/harden-runner@ec9f2d5744a09debf3a187a3f4f675c53b671911 # v2.13.0
        with:
          egress-policy: audit

      - name: Checkout Repository
        uses: actions/checkout@93cb6efe18208431cddfb8368fd83d5badbf9bfd # v5.0.1

      - name: Run Checkout Action
        uses: ./
        id: test-checkout
        with:
          checkout: true
          checkout-fetch-depth: 0
          checkout-ref: main
          checkout-token: ${{ secrets.GITHUB_TOKEN }}

      - name: Verify Checkout Outputs
        run: |
          echo "Checkout Ref: ${{ steps.test-checkout.outputs.checkout-ref }}"
          echo "Checkout Commit: ${{ steps.test-checkout.outputs.checkout-commit }}"
          git_value=$(git log -1 --oneline)
          echo "Git Commit: ${git_value}"

  test-setup-java:
    name: Test Setup Java Action
    runs-on: ubuntu-latest
    steps:
      - name: Harden Runner
        id: harden-runner
        uses: step-security/harden-runner@ec9f2d5744a09debf3a187a3f4f675c53b671911 # v2.13.0
        with:
          egress-policy: audit

      - name: Checkout Repository
        uses: actions/checkout@93cb6efe18208431cddfb8368fd83d5badbf9bfd # v5.0.1

      - name: Run Setup Java Action
        uses: ./
        id: test-setup-java
        with:
          setup-java: true
          java-distribution: 'temurin'
          java-version: '17'

      - name: Verify Java Outputs
        run: |
          echo "Java Distribution: ${{ steps.test-setup-java.outputs.java-distribution }}"
          echo "Java Version: ${{ steps.test-setup-java.outputs.java-version }}"
          echo "Java Path: ${{ steps.test-setup-java.outputs.java-path }}"
          echo "Java Cache Hit: ${{ steps.test-setup-java.outputs.java-cache-hit }}"
          java -version

  test-setup-gradle:
    name: Test Setup Gradle Action
    runs-on: ubuntu-latest
    steps:
      - name: Harden Runner
        id: harden-runner
        uses: step-security/harden-runner@ec9f2d5744a09debf3a187a3f4f675c53b671911 # v2.13.0
        with:
          egress-policy: audit

      - name: Checkout Repository
        uses: actions/checkout@93cb6efe18208431cddfb8368fd83d5badbf9bfd # v5.0.1

      - name: Run Setup Gradle Action
        uses: ./
        id: test-setup-gradle
        with:
          setup-gradle: true
          gradle-version: '7.5'

      - name: Verify Gradle Outputs
        run: |
          echo "Gradle Version: ${{ steps.test-setup-gradle.outputs.gradle-version }}"
          echo "Gradle Build Scan URL: ${{ steps.test-setup-gradle.outputs.gradle-build-scan-url }}"
          echo "Gradle Dependency Graph File: ${{ steps.test-setup-gradle.outputs.gradle-dependency-graph-file }}"
          gradle -v

  test-setup-node:
    name: Test Setup Node.js Action
    runs-on: ubuntu-latest
    steps:
      - name: Harden Runner
        id: harden-runner
        uses: step-security/harden-runner@ec9f2d5744a09debf3a187a3f4f675c53b671911 # v2.13.0
        with:
          egress-policy: audit

      - name: Checkout Repository
        uses: actions/checkout@93cb6efe18208431cddfb8368fd83d5badbf9bfd # v5.0.1

      - name: Run Setup Node.js Action
        uses: ./
        id: test-setup-node
        with:
          setup-node: true
          node-version: '18'

      - name: Verify Node.js Outputs
        run: |
          echo "Node.js Version: ${{ steps.test-setup-node.outputs.node-version }}"
          echo "Node.js Cache Hit: ${{ steps.test-setup-node.outputs.node-cache-hit }}"
          node -v
          npm -v

  test-setup-python:
    name: Test Setup Python Action
    runs-on: ubuntu-latest
    steps:
      - name: Harden Runner
        id: harden-runner
        uses: step-security/harden-runner@ec9f2d5744a09debf3a187a3f4f675c53b671911 # v2.13.0
        with:
          egress-policy: audit

      - name: Checkout Repository
        uses: actions/checkout@93cb6efe18208431cddfb8368fd83d5badbf9bfd # v5.0.1

      - name: Run Setup Python Action
        uses: ./
        id: test-setup-python
        with:
          setup-python: true
          python-version: '3.13'

      - name: Verify Python Outputs
        run: |
          echo "Python Version: ${{ steps.test-setup-python.outputs.python-version }}"
          echo "Python Path: ${{ steps.test-setup-python.outputs.python-path }}"
          echo "Python Cache Hit: ${{ steps.test-setup-python.outputs.python-cache-hit }}"
          python --version
          pip --version

  test-setup-go:
    name: Test Setup Go Action
    runs-on: ubuntu-latest
    steps:
      - name: Harden Runner
        id: harden-runner
        uses: step-security/harden-runner@ec9f2d5744a09debf3a187a3f4f675c53b671911 # v2.13.0
        with:
          egress-policy: audit

      - name: Checkout Repository
        uses: actions/checkout@93cb6efe18208431cddfb8368fd83d5badbf9bfd # v5.0.1

      - name: Run Setup Go Action
        uses: ./
        id: test-setup-go
        with:
          setup-go: true
          go-version: '1.20'

      - name: Verify Go Outputs
        run: |
          echo "Go Version: ${{ steps.test-setup-go.outputs.go-version }}"
          echo "Go Cache Hit: ${{ steps.test-setup-go.outputs.go-cache-hit }}"
          go version

  test-setup-rust:
    name: Test Setup Rust Action
    runs-on: ubuntu-latest
    steps:
      - name: Harden Runner
        id: harden-runner
        uses: step-security/harden-runner@ec9f2d5744a09debf3a187a3f4f675c53b671911 # v2.13.0
        with:
          egress-policy: audit

      - name: Checkout Repository
        uses: actions/checkout@93cb6efe18208431cddfb8368fd83d5badbf9bfd # v5.0.1

      - name: Run Setup Rust Action
        uses: ./
        id: test-setup-rust
        with:
          setup-rust: true
          rust-version: '1.70.0'

      - name: Verify Rust Outputs
        run: |
          echo "Rust Name: ${{ steps.test-setup-rust.outputs.rust-name }}"
          echo "Rust Cache Key: ${{ steps.test-setup-rust.outputs.rust-cachekey }}"
          rustc --version
          cargo --version

  test-setup-swift:
    name: Test Setup Swift Action
    runs-on: macos-latest
    steps:
      - name: Harden Runner
        id: harden-runner
        uses: step-security/harden-runner@ec9f2d5744a09debf3a187a3f4f675c53b671911 # v2.13.0
        with:
          egress-policy: audit

      - name: Checkout Repository
        uses: actions/checkout@93cb6efe18208431cddfb8368fd83d5badbf9bfd # v5.0.1

      - name: Run Setup Swift Action
        uses: ./
        id: test-setup-swift
        with:
          setup-swift: true
          swift-version: '5.7'

      - name: Verify Swift Outputs
        run: |
          echo "Swift Version: ${{ steps.test-setup-swift.outputs.swift-version }}"
          echo "Swift Toolchain: ${{ steps.test-setup-swift.outputs.swift-toolchain }}"
          echo "Swift SDKs: ${{ steps.test-setup-swift.outputs.swift-sdks }}"
          swift --version
